# Control Acces – Jurnal Intrări/Ieșiri

Desktop приложение для учёта входов/выходов людей и въездов/выездов автомобилей на территорию учреждения.

## Описание

Приложение предоставляет:
- Управление списком сотрудников и автомобилей
- Регистрацию входов/выходов с автоматической отметкой времени
- Просмотр текущих присутствующих на территории
- Историю всех событий с фильтрацией и поиском
- Экспорт данных в CSV
- Симуляцию ежедневной синхронизации с внешними системами

## Требования к системе

- Python 3.8 или выше
- PySide6
- SQLite (встроен в Python)

## Установка и запуск

### 1. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 2. Запуск приложения

#### Автоматический запуск (рекомендуется)
```bash
./run.sh
```

#### Ручной запуск
```bash
# Создать виртуальное окружение (только при первом запуске)
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# Запуск приложения
python app/ui/main.py
```

#### Запуск в существующем окружении
```bash
source venv/bin/activate
python app/ui/main.py
```

## Структура проекта

```
/
├── app/
│   ├── data/
│   │   ├── database.py          # Инициализация SQLite БД
│   │   ├── repositories.py      # CRUD операции
│   │   └── seed.py              # Генерация мок-данных
│   ├── domain/
│   │   ├── models.py            # Модели данных
│   │   ├── services.py          # Бизнес-логика
│   │   └── sync_mock.py         # Симуляция синхронизации
│   └── ui/
│       ├── main.py              # Точка входа в приложение
│       ├── main_window.py       # Главное окно
│       ├── widgets.py           # Общие UI компоненты
│       ├── employees_tab.py     # Вкладка "Angajați"
│       ├── vehicles_tab.py      # Вкладка "Vehicule"
│       ├── present_tab.py       # Вкладка "Prezenți acum"
│       ├── history_tab.py       # Вкладка "Istoric"
│       └── settings_tab.py      # Вкладка "Setări"
├── export/                      # Папка для CSV экспортов
├── requirements.txt
└── README.md
```

## Функциональные возможности

### Вкладки приложения

1. **Angajați** - Список сотрудников с кнопками "Intrare"/"Ieșire"
2. **Vehicule** - Список автомобилей с кнопками "Intrare"/"Ieșire"  
3. **Prezenți acum** - Кто сейчас находится на территории
4. **Istoric** - История событий с фильтрами и экспортом
5. **Setări** - Настройки и управление данными

### Основные функции

- **Автоматическое время**: При нажатии кнопок "Intrare"/"Ieșire" время устанавливается автоматически (Europe/Chisinau)
- **Поиск**: Мгновенный поиск по имени, департаменту, номеру авто
- **Предупреждения**: При некорректных последовательностях (два входа подряд) показывается предупреждение
- **Экспорт CSV**: История может быть экспортирована в файл CSV
- **Мок-синхронизация**: Имитация ежедневной загрузки данных из внешних систем

### База данных

Приложение использует SQLite базу данных `access_control.db`, которая автоматически создается при первом запуске.

Таблицы:
- `employees` - Сотрудники
- `vehicles` - Автомобили  
- `log_entries` - Журнал событий
- `sync_audit` - Аудит синхронизации

## Использование

### Первый запуск

При первом запуске приложение автоматически:
1. Создает базу данных SQLite в корне проекта
2. Генерирует 3 тестовых сотрудника (Ion Popescu, Maria Ionescu, Alexandru Stan)
3. Генерирует 3 тестовых автомобиля (ABC 123, CHI 456, BAL 789)
4. Создает несколько тестовых событий для демонстрации
5. Помечает 1 сотрудника и 1 автомобиль как присутствующих

### Регистрация входов/выходов

1. Перейдите на вкладку "Angajați" или "Vehicule"
2. Найдите нужного сотрудника/автомобиль через поиск
3. Нажмите кнопку "Intrare" (зеленая) или "Ieșire" (красная)
4. Событие автоматически записывается с текущим временем

### Просмотр текущих присутствующих

На вкладке "Prezenți acum" отображаются все, кто в данный момент находится на территории (последнее событие - "Intrare").

### Работа с историей

На вкладке "Istoric":
- Используйте фильтры для поиска конкретных событий
- Быстрые пресеты: "Azi", "Ieri", "Ultimele 7 zile"
- Экспортируйте результаты в CSV через кнопку "Export CSV"

### Настройки

На вкладке "Setări":
- **Încărcare zilnică (mock)** - Симулирует ежедневную синхронизацию
- **Resetare demo** - Полностью сбрасывает данные и создает новые

## Разработка и расширение

### Замена мок-синхронизации на реальную

Для интеграции с реальными системами модифицируйте `app/domain/sync_mock.py`:

1. Замените методы `_generate_new_employees()` и `_generate_new_vehicles()` на реальные API вызовы
2. Реализуйте логику обработки изменений в существующих записях
3. Добавьте обработку ошибок сети и валидацию данных

### Добавление новых функций

Приложение построено по модульной архитектуре:
- **Слой данных** (`app/data/`) - работа с базой данных
- **Слой домена** (`app/domain/`) - бизнес-логика  
- **Слой UI** (`app/ui/`) - пользовательский интерфейс

## Тестирование

### Основные тест-кейсы

1. **Множественные входы/выходы**: Отметьте сотрудника 3 раза за день → должно быть 3 записи
2. **Предупреждения**: Два "Intrare" подряд → показывается предупреждение, но запись добавляется
3. **Фильтр "Azi"**: В истории показываются только сегодняшние события
4. **Экспорт CSV**: Создается файл с отфильтрованными данными
5. **Мок-синхронизация**: Добавляются новые записи в sync_audit
6. **Поиск**: Поиск "ion" находит всех сотрудников с "ion" в имени

### Проверка работы

После запуска убедитесь что:
- ✅ Отображается список сотрудников и автомобилей
- ✅ Кнопки "Intrare"/"Ieșire" работают
- ✅ Время обновляется в шапке каждую секунду
- ✅ Вкладка "Prezenți acum" показывает присутствующих
- ✅ Поиск работает мгновенно
- ✅ Фильтры в истории применяются корректно
- ✅ CSV экспорт создает файл в папке export/

## Лицензия

Демонстрационное приложение для внутреннего использования.